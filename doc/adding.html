<HTML>
<HEAD>
<TITLE>
MHonArc v1.2.2 -- Adding Messages
</TITLE></HEAD>
<BODY>
[<A HREF=rcfile.html>Previous</A>][<A HREF=removing.html>Next</A>][<A HREF=mhonarc.html>Contents</A>][<A HREF="http://www.oac.uci.edu/indiv/ehood/MHonArc/faq.html">FAQ</A>][<A HREF="http://www.oac.uci.edu/indiv/ehood/MHonArc/bugs.html">Bugs</A>][<A HREF=http://www.oac.uci.edu/indiv/ehood/mhonarc.html>Home</A>]
<HR>

<H1><A NAME="31694">Adding Messages</A>
</H1>

<P>Adding messages to an archive is done via the <A HREF="overview.html#15460"><CODE>-add</CODE></A> option.  If no mailbox/folder 
arguments are given, <EM>MHonArc</EM> assumes that a <STRONG>single</STRONG> message is being added to 
the archive via <EM>standard input</EM>.  Otherwise, <EM>MHonArc</EM> adds the messages contained 
in the mail folders specified.
</P>
<DL>
<DT><STRONG>NOTE</STRONG> 

<DD><P> <EM>MHonArc</EM> will skip any messages that already exist in an archive. If a 
message to be added has a message-ID that equals a message-ID of an 
archived message, the message is skipped.
</P></DL>
<HR>
<H2><A NAME="MMM0">Examples
</A></H2>

<H3>Adding a mail folder
</H3>

<P>Here is example session adding an mail folder to an existing archive:
</P>
<PRE>% mhonarc -add test/www
Requiring MIME filter libraries ...
        mhexternal.pl
        mhtxthtml.pl
        mhtxtplain.pl
        mhtxtsetext.pl
Adding messages to ./maillist.html
Reading test/www/ ........................................
Writing HTML ...
49 messages

</PRE>

<H3><A NAME="40657">.forward</A>
</H3>

<P><EM>MHonArc</EM> can be used to add new messages as they are received by using the 
"<CODE>.forward</CODE>" file in your home directory. Here is how I would set up my 
<CODE>.forward</CODE> file to invoke <EM>MHonArc</EM> on incoming mail:
</P>
<PRE>\ehood, "|/mnt/ehood/bin/webnewmail #ehood"

</PRE>

<DL>
<DT><STRONG>NOTE</STRONG> on <CODE>.forward</CODE> entry:

<DD><P> The "<CODE>\ehood</CODE>" tells <CODE>sendmail</CODE> to still deposit the incoming message to my 
mail spool file. The "<CODE>#ehood</CODE>" Bourne shell comment is needed to insure 
the command is unique from another user. Otherwise, <CODE>sendmail</CODE> may not 
invoke the program for you or the other user.
</P></DL>
<P>"<CODE>webnewmail</CODE>" is a Perl program that calls <EM>MHonArc</EM> with the appropriate 
arguments. A wrapper program is used instead of calling <EM>MHonArc</EM> directly to 
keep the <CODE>.forward</CODE> file simple. Here is the code to the <CODE>webnewmail</CODE> program:
</P>
<PRE>#!/usr/local/bin/perl

$cmd = "/mnt/ehood/bin/mhonarc -add -quiet " .
 "-outdir /mnt/ehood/public_html/newmail";
open(M2H, "|$cmd");
print M2H &lt;STDIN&gt;;
close(M2H);

</PRE>

<P>The <CODE>webnewmail</CODE> can be modified to check the mail header before calling 
<EM>MHonArc</EM> to perform selective archiving of messages. For example, <CODE>webnewmail</CODE> 
can check the <CODE>To:</CODE> field and only archive messages that come from a specific 
mailing list.
</P>
<H3>Cron
</H3>

<P>This example uses <CODE>cron</CODE>(1) to update some mail archives from MH mail folders.
</P>
<P>The following entry is in my crontab file:
</P>
<PRE>0 0 * * * webmail

</PRE>

<P><CODE>webmail</CODE> is a script executed every night that calls <EM>MHonArc</EM> to perform the 
update:
</P>
<PRE>#! /bin/csh -f

umask 022
setenv M2H_RCFILE $HOME/.mhonarc.rc
## WWW messages
mhonarc -add \
          -outdir $HOME/public_html/doc/wwwmail \
          $HOME/mail/www
folder +www &gt;&amp; /dev/null
refile first-last +www.ar &gt;&amp; /dev/null    # Archive original messages

## Tools messages
mhonarc -add \
          -outdir $HOME/public_html/doc/toolsmail \
          $HOME/mail/tools $HOME/mail/dtd
folder +tools &gt;&amp; /dev/null
refile first-last +tools.ar &gt;&amp; /dev/null  # Archive original messages
folder +dtd &gt;&amp; /dev/null
refile first-last +dtd.ar &gt;&amp; /dev/null    # Archive original messages

folder +inbox &gt;&amp; /dev/null                # Set current folder to inbox


</PRE>

<P>To avoid mail everynight from <CODE>cron</CODE> due to output from <EM>MHonArc</EM>, the <CODE>-quiet</CODE> 
option can be used for each call to <EM>MHonArc</EM>, or use the following line in your 
crontab file:
</P>
<PRE>0 0 * * * webmail &gt; /dev/null
</PRE>

<P>Standard error is not redirected to <CODE>/dev/null</CODE> so mail is still received if errors 
occured during <EM>MHonArc</EM> execution.
</P>

<HR>
[<A HREF=rcfile.html>Previous</A>][<A HREF=removing.html>Next</A>][<A HREF=mhonarc.html>Contents</A>][<A HREF="http://www.oac.uci.edu/indiv/ehood/MHonArc/faq.html">FAQ</A>][<A HREF="http://www.oac.uci.edu/indiv/ehood/MHonArc/bugs.html">Bugs</A>][<A HREF=http://www.oac.uci.edu/indiv/ehood/mhonarc.html>Home</A>]
</BODY>
</HTML>
